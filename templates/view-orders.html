<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 주문 QR코드</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px; }
        #error-message { color: red; }
    </style>
</head>
<body>
    <h1>내 주문 QR코드</h1>
    <div id="order-container">
        <p>주문 정보를 불러오는 중...</p>
    </div>

    <script>
        // 페이지가 로드되면 자동으로 실행됩니다.
        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('order-container');

            // 1. URL에서 사용자 ID 가져오기
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('user_id');

            if (!userId) {
                container.innerHTML = '<h2 id="error-message">사용자 ID를 찾을 수 없습니다.</h2>';
                return;
            }

            // 2. 서버에 해당 사용자의 주문 정보 요청
            try {
                const response = await fetch(`/api/get-order/${userId}`);
                const data = await response.json();

                // 3. 받은 데이터로 화면 구성
                if (data.success) {
                    const order = data.order;
                    // QR 데이터는 주문 정보 전체를 담고 있는 JSON 문자열입니다.
                    const qrDataString = JSON.stringify(order);
                    // QR 코드 이미지를 생성해주는 외부 서비스를 이용합니다.
                    const qrImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrDataString)}`;

                    container.innerHTML = `
                        <img src="${qrImageUrl}" alt="주문 QR코드">
                        <h3>주문자 ID: ${order.userId}</h3>
                    `;
                } else {
                    container.innerHTML = `<h2 id="error-message">${data.message}</h2>`;
                }
            } catch (error) {
                container.innerHTML = '<h2 id="error-message">서버와 통신 중 오류가 발생했습니다.</h2>';
            }
        });
    </script>
</body>
</html>
