<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 주문 QR코드 확인</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background-color: #f4f7f6; }
        .container { text-align: center; padding: 30px; background-color: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; width: 90%; }
        input[type="text"] { width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 12px; font-size: 1em; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>내 주문 정보 확인</h1>
        <input type="text" id="viewUserIdInput" placeholder="주문 시 입력한 ID를 입력하세요">
        <button onclick="fetchOrderQR()">주문 조회하기</button>
        <div id="order-container" style="margin-top: 20px;"></div>
    </div>
    <script>
        async function fetchOrderQR() {
    // ... (userId 가져오기, 서버에 데이터 요청하는 부분은 동일) ...
            try {
                const response = await fetch(`/api/get-order/${userId}`);
                const data = await response.json();
                if (data.success) {
                    const order = data.order;

            // 1. ⭐️ QR코드에 담을 '핵심 요약 정보'를 새로 만듭니다. ⭐️
                    const qrSummary = {
                        userId: order.userId,
                        items: {}
                    };
                    for (const storeId in order.cart) {
                        const store = order.cart[storeId];
                        qrSummary.items[store.storeName] = [];
                        for (const productId in store.items) {
                            const item = store.items[productId];
                            qrSummary.items[store.storeName].push(`${item.name}(${item.quantity}개)`);
                        }
                    }
        
            // 2. '핵심 요약 정보'를 텍스트로 변환하여 QR코드를 생성합니다.
                     const qrDataString = JSON.stringify(qrSummary);

            // 3. 화면에는 전체 상세 내역과 QR코드를 함께 표시합니다.
                    let itemsHtml = '';
            // ... (상세 내역을 보여주는 HTML 생성 로직은 동일) ...
                    container.innerHTML = `...`; // QR 및 상세 내역 표시 HTML
                    new QRCode(document.getElementById("fetched-qrcode"), {
                        text: qrDataString,
                        width: 256,
                        height: 256,
                    });
                } else {
            // ... (오류 처리)
                }
            } catch (error) {
        // ... (오류 처리)
            }
        }
</script>
</body>
</html>
