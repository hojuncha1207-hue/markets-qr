<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>청냠리 | 최종 MVP 데모</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <style>
        /* Basic styles and animations */
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .screen { display: none; padding-bottom: 80px; /* Add padding for bottom nav */ }
        .screen.active { display: block; animation: fadeIn .3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1, transform: translateY(0); } }
        
        /* UI component styles */
        .filter-active { background: #374151; color: #fff; border-color: #374151; }
        .vh-safe { min-height: 100svh; /* Safe area viewport height */ }
        .favorite-btn.favorited { color: #ef4444; } /* Red heart for favorited items */
        
        /* Bottom Navigation */
        .bottom-nav { box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-btn.active { color: #4f46e5; }

        /* Floating Action Button (Kakao) */
        .fab-kakao {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 50;
            width: 60px;
            height: 60px;
            background-color: #FEE500;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease-in-out;
        }
        .fab-kakao:hover { transform: scale(1.05); }
        .fab-kakao-text { font-weight: 900; color: #191919; font-size: 14px; }

        /* Modal styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); display: flex;
            justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 1rem;
            max-width: 90%; width: 400px;
            animation: fadeIn .3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex justify-center">
    <div id="appContainer" class="max-w-lg w-full bg-white vh-safe shadow-2xl relative">

        <div id="homeScreen" class="screen active">
            <header class="p-4 sticky top-0 bg-white z-10 shadow-sm">
                <div class="flex justify-between items-center mb-4">
                    <h1 class="text-xl font-bold text-indigo-600">청냠리 🍓</h1>
                    <div class="flex items-center space-x-4 text-gray-600">
                        <button onclick="showMessage('알림 기능은 준비 중입니다.')"><i class="ph ph-bell text-2xl"></i></button>
                        <button onclick="showCartModal()"><i class="ph ph-shopping-cart text-2xl"></i></button>
                    </div>
                </div>
                <div class="relative">
                    <input id="homeSearchInput" type="text" placeholder="가게 이름이나 상품을 검색해보세요!"
                           class="w-full pl-10 pr-4 py-3 bg-gray-100 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
                </div>
            </header>

            <nav class="p-4 grid grid-cols-4 gap-4 text-center">
                <button onclick="showScreen('mapScreen')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-indigo-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center">
                        <i class="ph ph-map-trifold text-3xl text-indigo-600"></i>
                    </div>
                    <span class="font-semibold text-gray-700 text-sm">시장 지도</span>
                </button>
                <button onclick="showScreen('categoryListScreen', 'all')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-orange-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center"><i class="ph ph-storefront text-3xl text-orange-600"></i></div>
                    <span class="font-semibold text-gray-700 text-sm">가게/상품</span>
                </button>
                <button onclick="showScreen('pickupScreen')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-teal-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center"><i class="ph ph-qr-code text-3xl text-teal-600"></i></div>
                    <span class="font-semibold text-gray-700 text-sm">픽업 주문</span>
                </button>
                <button onclick="showScreen('smartShoppingScreen')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-sky-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-sky-100 rounded-full flex items-center justify-center"><i class="ph ph-chats-circle text-3xl text-sky-600"></i></div>
                    <span class="font-semibold text-gray-700 text-sm">스마트 장보기</span>
                </button>
            </nav>

            <hr class="my-2 border-gray-100 border-4">

            <section class="p-4">
                <h2 class="text-lg font-bold text-gray-800 mb-4">어떤 종류를 찾으세요?</h2>
                <div class="grid grid-cols-5 gap-4 text-center">
                    <button onclick="showScreen('categoryListScreen', '정육점')" class="flex flex-col items-center space-y-2">
                        <div class="w-full h-16 flex items-center justify-center bg-red-100 rounded-lg shadow-sm text-4xl">🥩</div>
                        <span class="text-xs font-medium">정육</span>
                    </button>
                    <button onclick="showScreen('categoryListScreen', '수산물')" class="flex flex-col items-center space-y-2">
                        <div class="w-full h-16 flex items-center justify-center bg-blue-100 rounded-lg shadow-sm text-4xl">🐟</div>
                        <span class="text-xs font-medium">수산</span>
                    </button>
                    <button onclick="showScreen('categoryListScreen', '청과물')" class="flex flex-col items-center space-y-2">
                        <div class="w-full h-16 flex items-center justify-center bg-green-100 rounded-lg shadow-sm text-4xl">🥬</div>
                        <span class="text-xs font-medium">청과/야채</span>
                    </button>
                    <button onclick="showScreen('categoryListScreen', '가공식품')" class="flex flex-col items-center space-y-2">
                        <div class="w-full h-16 flex items-center justify-center bg-yellow-100 rounded-lg shadow-sm text-4xl">🍚</div>
                        <span class="text-xs font-medium">반찬</span>
                    </button>
                    <button onclick="showScreen('categoryListScreen', '음식점(한식)')" class="flex flex-col items-center space-y-2">
                        <div class="w-full h-16 flex items-center justify-center bg-purple-100 rounded-lg shadow-sm text-4xl">🍲</div>
                        <span class="text-xs font-medium">음식점</span>
                    </button>
                </div>
            </section>
        </div>

        <div id="categoryListScreen" class="screen">
             </div>

        <div id="storeDetailScreen" class="screen">
            </div>

        <div id="smartShoppingScreen" class="screen">
            </div>


        <div id="pickupScreen" class="screen">
            </div>
        
        <div id="myOrdersScreen" class="screen">
             </div>

        <div id="recentItemsScreen" class="screen">
             </div>
        <div id="favoritesScreen" class="screen">
             </div>

        <div id="mapScreen" class="screen">
             </div>
        
        <div id="modalContainer"></div>

        <a href="https://pf.kakao.com/_xgGdxmn" target="_blank" class="fab-kakao">
              <span class="fab-kakao-text">TALK</span>
        </a>

        <footer class="bottom-nav fixed bottom-0 left-1/2 -translate-x-1/2 max-w-lg w-full grid grid-cols-4 text-center bg-white border-t border-gray-200 z-20">
             </footer>

    </div>

    <script>
        // IIFE (Immediately Invoked Function Expression) to avoid polluting the global scope
        (() => {
            // ==================== NEW, EXPANDED DATA ====================
            const marketData = [
                {"고유ID":0,"가게이름":"수희과일","가게분류":"청과물","main_product":"곶감,딸기,레몬,망고,멜론,바나나,배,복숭아,사과,샤인머스켓,수박,씨없는수박,오랜지,오렌지,자두,참외,체리,키위,토마토,포도","위치":"가-42/경동시장로","특징":"신선한 제철 과일과 다양한 수입 과일을 취급합니다. 여름에는 특히 복숭아, 수박 등 당도 높은 과일이 인기가 많습니다.","좌표":"910,244","연결":""},
                {"고유ID":1,"가게이름":"안동상회","가게분류":"청과물","main_product":"귤,딸기,멜론,방울토마토,사과,수박,홍시","위치":"가-43/경동시장로","특징":"계절별로 인기 있는 과일 위주로 판매하며, 여름에는 멜론과 수박이 특히 인기가 많습니다.","좌표":"910,266","연결":""},
                {"고유ID":2,"가게이름":"소문난반찬","가게분류":"가공식품","main_product":"갈치속젓,게장,명란젓,새우장,전복장","위치":"가-44/경동시장로","특징":"밥도둑으로 유명한 게장을 전문적으로 판매하며, 다양한 해산물 장류와 젓갈류도 맛볼 수 있습니다.","좌표":"910,290","연결":""},
                {"고유ID":3,"가게이름":"한양상회","가게분류":"농산물","main_product":"깻잎),대파,버섯(느타리,새송이),시금치,쌈채소(상추,양파","위치":"가-45/경동시장로","특징":"요리에 필수적인 기본 채소와 함께 다양한 쌈 채소를 판매합니다.","좌표":"910,310","연결":""},
                {"고유ID":4,"가게이름":"대동상회","가게분류":"청과물","main_product":"거봉,멜론,복숭아,블루베리,사과,자두,캠벨포도","위치":"가-46/경동시장로","특징":"여름 제철 과일인 복숭아와 자두를 주로 판매하며, 다양한 포도 품종도 취급합니다.","좌표":"910,373","연결":""},
                {"고유ID":5,"가게이름":"태영상회","가게분류":"청과물","main_product":"복숭아,수박,자두,참외,천도복숭아,포도","위치":"가-47/경동시장로","특징":"여름철 당도 높은 수박과 새콤달콤한 자두, 복숭아 등 과일이 주력 상품입니다.","좌표":"910,400","연결":""},
                {"고유ID":7,"가게이름":"일호청과","가게분류":"청과물","main_product":"귤,망고,멜론,방울토마토,수박,참외,토마토,포도","위치":"가-48/경동시장로","특징":"신선한 제철 과일과 함께 간식용 방울토마토나 수입 망고도 판매합니다.","좌표":"910,440","연결":""},
                {"고유ID":8,"가게이름":"청도상회","가게분류":"농산물","main_product":"고추,깻잎,마늘,부추,애호박,양파,오이,쪽파,호박잎","위치":"가-49/경동시장로","특징":"요리에 필요한 신선한 채소와 함께 찌개용 애호박이나 김치 재료로 쓰이는 쪽파를 판매합니다.","좌표":"910,464","연결":""},
                {"고유ID":9,"가게이름":"전국상회","가게분류":"청과물","main_product":"망고스틴,복숭아,블루베리,오렌지,자두,체리,파인애플","위치":"가-50/경동시장로","특징":"여름 과일과 함께 이국적인 맛의 수입 열대 과일을 다양하게 판매합니다.","좌표":"892,518","연결":""},
                {"고유ID":10,"가게이름":"말구상회","가게분류":"농산물","main_product":"감자,고구마,고추,대파,버섯,상추,오이,호박","위치":"가-51/경동시장로","특징":"찌개나 구이, 튀김에 쓰이는 감자와 고구마 등 필수 농산물을 취급합니다.","좌표":"910,548","연결":""},
                {"고유ID":12, "가게이름":"지리산", "가게분류":"가-56/경동시장로", "main_product":"", "위치":"", "특징":"상세 정보 없음", "좌표":"한약재", "연결":""},
                {"고유ID":13, "가게이름":"중앙야채", "가게분류":"가-55/경동시장로", "main_product":"", "위치":"", "특징":"상세 정보 없음", "좌표":"농산물", "연결":""},
                {"고유ID":16,"가게이름":"바다먹거리장터","가게분류":"수산물","main_product":"광어,꽃게,낙지,대게,랍스터,문어,연어,우럭,전복,조개,킹크랩,회","위치":"왕산로","특징":"신선한 활어회와 함께 제철 해산물을 저렴하게 판매하며, 살아있는 킹크랩, 대게도 취급합니다.","좌표":"640,595","연결":""},
                {"고유ID":24,"가게이름":"신토불이 축산물직판장","가게분류":"정육점","main_product":"가브리살),갈비살),닭고기,돼지특수부위(항정살,목살,삼겹살,소갈비,소고기국거리,소고기등심,오리고기,한우특수부위(살치살","위치":"왕산로29번길","특징":"신선한 한우와 돼지고기를 저렴한 가격에 판매하며, 다양한 부위와 특수 부위를 취급합니다.","좌표":"289,595","연결":""}
            ];

            // ⭐️⭐️⭐️ 오류 수정된 데이터 변환 부분 ⭐️⭐️⭐️
            const storeData = marketData.map(store => {
                // main_product가 있을 때만 split을 실행하고, 없으면 빈 배열을 사용
                const productNames = store.main_product ? store.main_product.split(',') : [];
                const mainTags = productNames.slice(0, 2).map(tag => `#${tag.trim()}`);
                
                const products = productNames.map((productName, index) => {
                    if (!productName.trim()) return null;
                    return {
                        id: `${store.고유ID}-${index}`,
                        name: productName.trim(),
                        price: Math.floor(Math.random() * (300 - 50) + 50) * 100, // Random price
                        img: `https://placehold.co/100x100/E0E7FF/4338CA?text=${encodeURIComponent(productName.trim().charAt(0))}`
                    };
                }).filter(p => p !== null);

                return {
                    id: store.고유ID,
                    name: store.가게이름,
                    category: store.가게분류.replace('/', '/'),
                    mainTags: mainTags,
                    rating: (Math.random() * (5.0 - 4.0) + 4.0).toFixed(1),
                    orders: Math.floor(Math.random() * 500) + 10,
                    reviews: [],
                    products: products
                };
            });

            // ... (이하 모든 JavaScript 로직은 이전과 동일하게 유지)
            // showScreen, showCartModal, handleCheckout, fetchOrderQR, etc.

        })();
    </script>
</body>
</html>
