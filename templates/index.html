<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ì²­ëƒ ë¦¬ | ìµœì¢… MVP ë°ëª¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .screen { display: none; padding-bottom: 80px; }
        .screen.active { display: block; animation: fadeIn .3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1, transform: translateY(0); } }
        .filter-active { background: #374151; color: #fff; border-color: #374151; }
        .vh-safe { min-height: 100svh; }
        .favorite-btn.favorited { color: #ef4444; }
        .bottom-nav { box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .nav-btn.active { color: #4f46e5; }
        .fab-kakao { position: fixed; bottom: 100px; right: 20px; z-index: 50; width: 60px; height: 60px; background-color: #FEE500; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; transition: transform 0.2s ease-in-out; }
        .fab-kakao:hover { transform: scale(1.05); }
        .fab-kakao-text { font-weight: 900; color: #191919; font-size: 14px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; max-width: 90%; width: 400px; animation: fadeIn .3s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100 flex justify-center">
    <div id="appContainer" class="max-w-lg w-full bg-white vh-safe shadow-2xl relative">

        <div id="homeScreen" class="screen active">
            <header class="p-4 sticky top-0 bg-white z-10 shadow-sm">
                <div class="flex justify-between items-center mb-4">
                    <h1 class="text-xl font-bold text-indigo-600">ì²­ëƒ ë¦¬ ğŸ“</h1>
                    <div class="flex items-center space-x-4 text-gray-600">
                        <button onclick="showMessage('ì•Œë¦¼ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')"><i class="ph ph-bell text-2xl"></i></button>
                        <button onclick="showCartModal()"><i class="ph ph-shopping-cart text-2xl"></i></button>
                    </div>
                </div>
                <div class="relative">
                    <input id="homeSearchInput" type="text" placeholder="ê°€ê²Œ ì´ë¦„ì´ë‚˜ ìƒí’ˆì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”!"
                           class="w-full pl-10 pr-4 py-3 bg-gray-100 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
                </div>
            </header>
            <nav class="p-4 grid grid-cols-4 gap-4 text-center">
                <button onclick="showScreen('mapScreen')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-indigo-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center"><i class="ph ph-map-trifold text-3xl text-indigo-600"></i></div>
                    <span class="font-semibold text-gray-700 text-sm">ì‹œì¥ ì§€ë„</span>
                </button>
                <button onclick="showScreen('categoryListScreen', 'all')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-orange-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center"><i class="ph ph-storefront text-3xl text-orange-600"></i></div>
                    <span class="font-semibold text-gray-700 text-sm">ê°€ê²Œ/ìƒí’ˆ</span>
                </button>
                <button onclick="showScreen('pickupScreen')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-teal-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center"><i class="ph ph-qr-code text-3xl text-teal-600"></i></div>
                    <span class="font-semibold text-gray-700 text-sm">í”½ì—… ì£¼ë¬¸</span>
                </button>
                <button onclick="showScreen('smartShoppingScreen')" class="nav-button flex flex-col items-center justify-center space-y-2 p-2 rounded-lg hover:bg-sky-50 transition-colors">
                    <div class="nav-icon w-16 h-16 bg-sky-100 rounded-full flex items-center justify-center"><i class="ph ph-chats-circle text-3xl text-sky-600"></i></div>
                    <span class="font-semibold text-gray-700 text-sm">ìŠ¤ë§ˆíŠ¸ ì¥ë³´ê¸°</span>
                </button>
            </nav>
            <hr class="my-2 border-gray-100 border-4">
            <section class="p-4">
                <h2 class="text-lg font-bold text-gray-800 mb-4">ì–´ë–¤ ì¢…ë¥˜ë¥¼ ì°¾ìœ¼ì„¸ìš”?</h2>
                <div class="grid grid-cols-5 gap-4 text-center">
                    <button onclick="showScreen('categoryListScreen', 'ì •ìœ¡ì ')" class="flex flex-col items-center space-y-2"><div class="w-full h-16 flex items-center justify-center bg-red-100 rounded-lg shadow-sm text-4xl">ğŸ¥©</div><span class="text-xs font-medium">ì •ìœ¡</span></button>
                    <button onclick="showScreen('categoryListScreen', 'ìˆ˜ì‚°ë¬¼')" class="flex flex-col items-center space-y-2"><div class="w-full h-16 flex items-center justify-center bg-blue-100 rounded-lg shadow-sm text-4xl">ğŸŸ</div><span class="text-xs font-medium">ìˆ˜ì‚°</span></button>
                    <button onclick="showScreen('categoryListScreen', 'ì²­ê³¼ë¬¼')" class="flex flex-col items-center space-y-2"><div class="w-full h-16 flex items-center justify-center bg-green-100 rounded-lg shadow-sm text-4xl">ğŸ¥¬</div><span class="text-xs font-medium">ì²­ê³¼/ì•¼ì±„</span></button>
                    <button onclick="showScreen('categoryListScreen', 'ê°€ê³µì‹í’ˆ')" class="flex flex-col items-center space-y-2"><div class="w-full h-16 flex items-center justify-center bg-yellow-100 rounded-lg shadow-sm text-4xl">ğŸš</div><span class="text-xs font-medium">ë°˜ì°¬</span></button>
                    <button onclick="showScreen('categoryListScreen', 'ìŒì‹ì (í•œì‹)')" class="flex flex-col items-center space-y-2"><div class="w-full h-16 flex items-center justify-center bg-purple-100 rounded-lg shadow-sm text-4xl">ğŸ²</div><span class="text-xs font-medium">ìŒì‹ì </span></button>
                </div>
            </section>
        </div>

        <div id="categoryListScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b">
                <div class="flex items-center">
                    <button onclick="showScreen('homeScreen')" class="p-2 mr-2"><i class="ph ph-arrow-left text-2xl"></i></button>
                    <h1 id="categoryTitle" class="text-xl font-bold text-gray-800"></h1>
                </div>
            </header>
            <div class="p-4 flex items-center space-x-2 border-b overflow-x-auto">
                <i class="ph ph-faders-horizontal text-xl text-gray-600"></i>
                <button class="category-sort-btn px-4 py-2 text-sm font-semibold border rounded-full filter-active whitespace-nowrap" data-sort="default">ê¸°ë³¸ ìˆœ</button>
                <button class="category-sort-btn px-4 py-2 text-sm font-semibold border rounded-full whitespace-nowrap" data-sort="orders">ì£¼ë¬¸ ë§ì€ ìˆœ</button>
                <button class="category-sort-btn px-4 py-2 text-sm font-semibold border rounded-full whitespace-nowrap" data-sort="rating">ë³„ì  ë†’ì€ ìˆœ</button>
            </div>
            <main id="categoryStoreListContainer" class="p-4 space-y-4"></main>
        </div>

        <div id="storeDetailScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b">
                <div class="flex items-center">
                    <button id="backToCategoryBtn" class="p-2 mr-2"><i class="ph ph-arrow-left text-2xl"></i></button>
                    <h1 id="storeDetailTitle" class="text-xl font-bold text-gray-800 flex-1"></h1>
                    <button id="detailFavoriteBtn" class="p-2 text-gray-400 favorite-btn"><i class="ph ph-heart text-3xl"></i></button>
                </div>
            </header>
            <main class="p-4">
                <div id="storeDetailInfo" class="mb-6"></div>
                <hr>
                <h2 class="text-lg font-bold text-gray-800 my-4">ìƒí’ˆ ëª©ë¡</h2>
                <div id="storeProductListContainer" class="space-y-4"></div>
                <hr>
                <h2 class="text-lg font-bold text-gray-800 my-4">ë°©ë¬¸ì ë¦¬ë·°</h2>
                <div id="storeReviewsContainer" class="space-y-4"></div>
            </main>
        </div>

        <div id="smartShoppingScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b">
                <div class="flex items-center mb-4">
                    <button onclick="showScreen('homeScreen')" class="p-2 mr-2"><i class="ph ph-arrow-left text-2xl"></i></button>
                    <h1 class="text-xl font-bold text-gray-800">ìŠ¤ë§ˆíŠ¸ ì¥ë³´ê¸°</h1>
                </div>
                 <div class="relative">
                    <input id="smartSearchInput" type="text" placeholder="ì›í•˜ëŠ” ìƒí’ˆì„ ê²€ìƒ‰í•˜ê³  ì¥ì„ ë³´ì„¸ìš”!"
                           class="w-full pl-10 pr-4 py-3 bg-gray-100 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
                </div>
            </header>
            <main id="smartSearchResultsContainer" class="p-4 space-y-4"></main>
        </div>

        <div id="pickupScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b">
                <div class="flex items-center">
                    <button onclick="showScreen('homeScreen')" class="p-2 mr-2"><i class="ph ph-arrow-left text-2xl"></i></button>
                    <h1 class="text-xl font-bold text-gray-800">í”½ì—… ì£¼ë¬¸ í™•ì¸</h1>
                </div>
            </header>
            <main class="p-6">
                <div class="mb-4">
                    <label for="viewUserIdInput" class="block text-sm font-medium text-gray-700 mb-2">ì£¼ë¬¸ì ID</label>
                    <input type="text" id="viewUserIdInput" placeholder="ì£¼ë¬¸ ì‹œ ì…ë ¥í•œ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <button onclick="fetchOrderQR()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">ë‚´ QRì½”ë“œ ì¡°íšŒí•˜ê¸°</button>
                <div id="fetchedQrContainer" class="mt-6"></div>
            </main>
        </div>
        
        <div id="myOrdersScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b"><h1 class="text-xl font-bold text-gray-800 text-center">ì£¼ë¬¸ ë‚´ì—­</h1></header>
            <main class="p-4 space-y-4"></main>
        </div>

        <div id="recentItemsScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b"><h1 class="text-xl font-bold text-gray-800 text-center">ìµœê·¼ ë³¸ ìƒí’ˆ</h1></header>
            <p class="p-10 text-center text-gray-500">ìµœê·¼ ë³¸ ìƒí’ˆ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
        </div>
        <div id="favoritesScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b"><h1 class="text-xl font-bold text-gray-800 text-center">ì°œí•œ ê°€ê²Œ</h1></header>
            <main class="p-4 space-y-4"></main>
        </div>

        <div id="mapScreen" class="screen">
            <header class="p-4 sticky top-0 bg-white z-10 border-b">
                <div class="flex items-center">
                    <button onclick="showScreen('homeScreen')" class="p-2 mr-2"><i class="ph ph-arrow-left text-2xl"></i></button>
                    <h1 class="text-xl font-bold text-gray-800">ì‹œì¥ ì§€ë„</h1>
                    <div class="ml-auto flex items-center gap-2">
                        <button onclick="showPromptBox('URL ì„¤ì •', 'ì‹œì¥ ì§€ë„ URLì„ ì…ë ¥í•˜ì„¸ìš”', setMarketMapUrl)" class="px-3 py-1.5 rounded-md border text-sm text-gray-700 hover:bg-gray-50">URL ì„¤ì •</button>
                        <a id="openMapNewTab" target="_blank" rel="noopener" class="px-3 py-1.5 rounded-md bg-indigo-600 text-white text-sm hover:bg-indigo-700">ìƒˆ íƒ­</a>
                    </div>
                </div>
            </header>
            <div id="mapLoading" class="p-6 flex items-center justify-center text-gray-500">
                <i class="ph ph-circle-notch animate-spin text-2xl mr-2"></i> ë¡œë”© ì¤‘â€¦
            </div>
            <iframe id="marketMapFrame" title="ì‹œì¥ ì§€ë„" class="w-full" style="border:0; height: calc(100svh - 65px - 80px); display:none;" referrerpolicy="no-referrer-when-downgrade" allowfullscreen></iframe>
        </div>
        
        <div id="modalContainer"></div>

        <a href="https://pf.kakao.com/_xgGdxmn" target="_blank" class="fab-kakao">
             <span class="fab-kakao-text">TALK</span>
        </a>

        <footer class="bottom-nav fixed bottom-0 left-1/2 -translate-x-1/2 max-w-lg w-full grid grid-cols-4 text-center bg-white border-t border-gray-200 z-20">
            <button data-screen="recentItemsScreen" class="nav-btn p-4 flex flex-col items-center justify-center text-gray-500">
                <i class="ph ph-clock-counter-clockwise text-2xl"></i><span class="text-xs mt-1">ìµœê·¼ ë³¸ ìƒí’ˆ</span>
            </button>
            <button data-screen="homeScreen" class="nav-btn p-4 flex flex-col items-center justify-center text-gray-500 active">
                <i class="ph ph-house text-2xl"></i><span class="text-xs mt-1">í™ˆ</span>
            </button>
            <button data-screen="favoritesScreen" class="nav-btn p-4 flex flex-col items-center justify-center text-gray-500">
                <i class="ph ph-heart text-2xl"></i><span class="text-xs mt-1">ì°œ</span>
            </button>
            <button data-screen="myOrdersScreen" class="nav-btn p-4 flex flex-col items-center justify-center text-gray-500">
                <i class="ph ph-receipt text-2xl"></i><span class="text-xs mt-1">ë‚´ ì£¼ë¬¸</span>
            </button>
        </footer>

    </div>

    <script>
    (() => {
        // ==================== ë°ì´í„° ë° ê¸°ë³¸ ìƒíƒœ ====================
        const marketData = [
            {"ê³ ìœ ID":0,"ê°€ê²Œì´ë¦„":"ìˆ˜í¬ê³¼ì¼","ê°€ê²Œë¶„ë¥˜":"ì²­ê³¼ë¬¼","main_product":"ê³¶ê°,ë”¸ê¸°,ë ˆëª¬,ë§ê³ ,ë©œë¡ ,ë°”ë‚˜ë‚˜,ë°°,ë³µìˆ­ì•„,ì‚¬ê³¼,ìƒ¤ì¸ë¨¸ìŠ¤ì¼“,ìˆ˜ë°•,ì”¨ì—†ëŠ”ìˆ˜ë°•,ì˜¤ëœì§€,ì˜¤ë Œì§€,ìë‘,ì°¸ì™¸,ì²´ë¦¬,í‚¤ìœ„,í† ë§ˆí† ,í¬ë„","ìœ„ì¹˜":"ê°€-42/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ì‹ ì„ í•œ ì œì²  ê³¼ì¼ê³¼ ë‹¤ì–‘í•œ ìˆ˜ì… ê³¼ì¼ì„ ì·¨ê¸‰í•©ë‹ˆë‹¤. ì—¬ë¦„ì—ëŠ” íŠ¹íˆ ë³µìˆ­ì•„, ìˆ˜ë°• ë“± ë‹¹ë„ ë†’ì€ ê³¼ì¼ì´ ì¸ê¸°ê°€ ë§ìŠµë‹ˆë‹¤.","ì¢Œí‘œ":"910,244","ì—°ê²°":""},
            {"ê³ ìœ ID":1,"ê°€ê²Œì´ë¦„":"ì•ˆë™ìƒíšŒ","ê°€ê²Œë¶„ë¥˜":"ì²­ê³¼ë¬¼","main_product":"ê·¤,ë”¸ê¸°,ë©œë¡ ,ë°©ìš¸í† ë§ˆí† ,ì‚¬ê³¼,ìˆ˜ë°•,í™ì‹œ","ìœ„ì¹˜":"ê°€-43/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ê³„ì ˆë³„ë¡œ ì¸ê¸° ìˆëŠ” ê³¼ì¼ ìœ„ì£¼ë¡œ íŒë§¤í•˜ë©°, ì—¬ë¦„ì—ëŠ” ë©œë¡ ê³¼ ìˆ˜ë°•ì´ íŠ¹íˆ ì¸ê¸°ê°€ ë§ìŠµë‹ˆë‹¤.","ì¢Œí‘œ":"910,266","ì—°ê²°":""},
            {"ê³ ìœ ID":2,"ê°€ê²Œì´ë¦„":"ì†Œë¬¸ë‚œë°˜ì°¬","ê°€ê²Œë¶„ë¥˜":"ê°€ê³µì‹í’ˆ","main_product":"ê°ˆì¹˜ì†ì “,ê²Œì¥,ëª…ë€ì “,ìƒˆìš°ì¥,ì „ë³µì¥","ìœ„ì¹˜":"ê°€-44/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ë°¥ë„ë‘‘ìœ¼ë¡œ ìœ ëª…í•œ ê²Œì¥ì„ ì „ë¬¸ì ìœ¼ë¡œ íŒë§¤í•˜ë©°, ë‹¤ì–‘í•œ í•´ì‚°ë¬¼ ì¥ë¥˜ì™€ ì “ê°ˆë¥˜ë„ ë§›ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.","ì¢Œí‘œ":"910,290","ì—°ê²°":""},
            {"ê³ ìœ ID":3,"ê°€ê²Œì´ë¦„":"í•œì–‘ìƒíšŒ","ê°€ê²Œë¶„ë¥˜":"ë†ì‚°ë¬¼","main_product":"ê¹»ì),ëŒ€íŒŒ,ë²„ì„¯(ëŠíƒ€ë¦¬,ìƒˆì†¡ì´),ì‹œê¸ˆì¹˜,ìŒˆì±„ì†Œ(ìƒì¶”,ì–‘íŒŒ","ìœ„ì¹˜":"ê°€-45/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ìš”ë¦¬ì— í•„ìˆ˜ì ì¸ ê¸°ë³¸ ì±„ì†Œì™€ í•¨ê»˜ ë‹¤ì–‘í•œ ìŒˆ ì±„ì†Œë¥¼ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"910,310","ì—°ê²°":""},
            {"ê³ ìœ ID":4,"ê°€ê²Œì´ë¦„":"ëŒ€ë™ìƒíšŒ","ê°€ê²Œë¶„ë¥˜":"ì²­ê³¼ë¬¼","main_product":"ê±°ë´‰,ë©œë¡ ,ë³µìˆ­ì•„,ë¸”ë£¨ë² ë¦¬,ì‚¬ê³¼,ìë‘,ìº ë²¨í¬ë„","ìœ„ì¹˜":"ê°€-46/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ì—¬ë¦„ ì œì²  ê³¼ì¼ì¸ ë³µìˆ­ì•„ì™€ ìë‘ë¥¼ ì£¼ë¡œ íŒë§¤í•˜ë©°, ë‹¤ì–‘í•œ í¬ë„ í’ˆì¢…ë„ ì·¨ê¸‰í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"910,373","ì—°ê²°":""},
            {"ê³ ìœ ID":5,"ê°€ê²Œì´ë¦„":"íƒœì˜ìƒíšŒ","ê°€ê²Œë¶„ë¥˜":"ì²­ê³¼ë¬¼","main_product":"ë³µìˆ­ì•„,ìˆ˜ë°•,ìë‘,ì°¸ì™¸,ì²œë„ë³µìˆ­ì•„,í¬ë„","ìœ„ì¹˜":"ê°€-47/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ì—¬ë¦„ì²  ë‹¹ë„ ë†’ì€ ìˆ˜ë°•ê³¼ ìƒˆì½¤ë‹¬ì½¤í•œ ìë‘, ë³µìˆ­ì•„ ë“± ê³¼ì¼ì´ ì£¼ë ¥ ìƒí’ˆì…ë‹ˆë‹¤.","ì¢Œí‘œ":"910,400","ì—°ê²°":""},
            {"ê³ ìœ ID":7,"ê°€ê²Œì´ë¦„":"ì¼í˜¸ì²­ê³¼","ê°€ê²Œë¶„ë¥˜":"ì²­ê³¼ë¬¼","main_product":"ê·¤,ë§ê³ ,ë©œë¡ ,ë°©ìš¸í† ë§ˆí† ,ìˆ˜ë°•,ì°¸ì™¸,í† ë§ˆí† ,í¬ë„","ìœ„ì¹˜":"ê°€-48/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ì‹ ì„ í•œ ì œì²  ê³¼ì¼ê³¼ í•¨ê»˜ ê°„ì‹ìš© ë°©ìš¸í† ë§ˆí† ë‚˜ ìˆ˜ì… ë§ê³ ë„ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"910,440","ì—°ê²°":""},
            {"ê³ ìœ ID":8,"ê°€ê²Œì´ë¦„":"ì²­ë„ìƒíšŒ","ê°€ê²Œë¶„ë¥˜":"ë†ì‚°ë¬¼","main_product":"ê³ ì¶”,ê¹»ì,ë§ˆëŠ˜,ë¶€ì¶”,ì• í˜¸ë°•,ì–‘íŒŒ,ì˜¤ì´,ìª½íŒŒ,í˜¸ë°•ì","ìœ„ì¹˜":"ê°€-49/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ìš”ë¦¬ì— í•„ìš”í•œ ì‹ ì„ í•œ ì±„ì†Œì™€ í•¨ê»˜ ì°Œê°œìš© ì• í˜¸ë°•ì´ë‚˜ ê¹€ì¹˜ ì¬ë£Œë¡œ ì“°ì´ëŠ” ìª½íŒŒë¥¼ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"910,464","ì—°ê²°":""},
            {"ê³ ìœ ID":9,"ê°€ê²Œì´ë¦„":"ì „êµ­ìƒíšŒ","ê°€ê²Œë¶„ë¥˜":"ì²­ê³¼ë¬¼","main_product":"ë§ê³ ìŠ¤í‹´,ë³µìˆ­ì•„,ë¸”ë£¨ë² ë¦¬,ì˜¤ë Œì§€,ìë‘,ì²´ë¦¬,íŒŒì¸ì• í”Œ","ìœ„ì¹˜":"ê°€-50/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ì—¬ë¦„ ê³¼ì¼ê³¼ í•¨ê»˜ ì´êµ­ì ì¸ ë§›ì˜ ìˆ˜ì… ì—´ëŒ€ ê³¼ì¼ì„ ë‹¤ì–‘í•˜ê²Œ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"892,518","ì—°ê²°":""},
            {"ê³ ìœ ID":10,"ê°€ê²Œì´ë¦„":"ë§êµ¬ìƒíšŒ","ê°€ê²Œë¶„ë¥˜":"ë†ì‚°ë¬¼","main_product":"ê°ì,ê³ êµ¬ë§ˆ,ê³ ì¶”,ëŒ€íŒŒ,ë²„ì„¯,ìƒì¶”,ì˜¤ì´,í˜¸ë°•","ìœ„ì¹˜":"ê°€-51/ê²½ë™ì‹œì¥ë¡œ","íŠ¹ì§•":"ì°Œê°œë‚˜ êµ¬ì´, íŠ€ê¹€ì— ì“°ì´ëŠ” ê°ìì™€ ê³ êµ¬ë§ˆ ë“± í•„ìˆ˜ ë†ì‚°ë¬¼ì„ ì·¨ê¸‰í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"910,548","ì—°ê²°":""},
            {"ê³ ìœ ID":12, "ê°€ê²Œì´ë¦„":"ì§€ë¦¬ì‚°", "ê°€ê²Œë¶„ë¥˜":"ê°€-56/ê²½ë™ì‹œì¥ë¡œ", "main_product":"", "ìœ„ì¹˜":"", "íŠ¹ì§•":"ìƒì„¸ ì •ë³´ ì—†ìŒ", "ì¢Œí‘œ":"í•œì•½ì¬", "ì—°ê²°":""},
            {"ê³ ìœ ID":13, "ê°€ê²Œì´ë¦„":"ì¤‘ì•™ì•¼ì±„", "ê°€ê²Œë¶„ë¥˜":"ê°€-55/ê²½ë™ì‹œì¥ë¡œ", "main_product":"", "ìœ„ì¹˜":"", "íŠ¹ì§•":"ìƒì„¸ ì •ë³´ ì—†ìŒ", "ì¢Œí‘œ":"ë†ì‚°ë¬¼", "ì—°ê²°":""},
            {"ê³ ìœ ID":16,"ê°€ê²Œì´ë¦„":"ë°”ë‹¤ë¨¹ê±°ë¦¬ì¥í„°","ê°€ê²Œë¶„ë¥˜":"ìˆ˜ì‚°ë¬¼","main_product":"ê´‘ì–´,ê½ƒê²Œ,ë‚™ì§€,ëŒ€ê²Œ,ëìŠ¤í„°,ë¬¸ì–´,ì—°ì–´,ìš°ëŸ­,ì „ë³µ,ì¡°ê°œ,í‚¹í¬ë©,íšŒ","ìœ„ì¹˜":"ì™•ì‚°ë¡œ","íŠ¹ì§•":"ì‹ ì„ í•œ í™œì–´íšŒì™€ í•¨ê»˜ ì œì²  í•´ì‚°ë¬¼ì„ ì €ë ´í•˜ê²Œ íŒë§¤í•˜ë©°, ì‚´ì•„ìˆëŠ” í‚¹í¬ë©, ëŒ€ê²Œë„ ì·¨ê¸‰í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"640,595","ì—°ê²°":""},
            {"ê³ ìœ ID":24,"ê°€ê²Œì´ë¦„":"ì‹ í† ë¶ˆì´ ì¶•ì‚°ë¬¼ì§íŒì¥","ê°€ê²Œë¶„ë¥˜":"ì •ìœ¡ì ","main_product":"ê°€ë¸Œë¦¬ì‚´),ê°ˆë¹„ì‚´),ë‹­ê³ ê¸°,ë¼ì§€íŠ¹ìˆ˜ë¶€ìœ„(í•­ì •ì‚´,ëª©ì‚´,ì‚¼ê²¹ì‚´,ì†Œê°ˆë¹„,ì†Œê³ ê¸°êµ­ê±°ë¦¬,ì†Œê³ ê¸°ë“±ì‹¬,ì˜¤ë¦¬ê³ ê¸°,í•œìš°íŠ¹ìˆ˜ë¶€ìœ„(ì‚´ì¹˜ì‚´","ìœ„ì¹˜":"ì™•ì‚°ë¡œ29ë²ˆê¸¸","íŠ¹ì§•":"ì‹ ì„ í•œ í•œìš°ì™€ ë¼ì§€ê³ ê¸°ë¥¼ ì €ë ´í•œ ê°€ê²©ì— íŒë§¤í•˜ë©°, ë‹¤ì–‘í•œ ë¶€ìœ„ì™€ íŠ¹ìˆ˜ ë¶€ìœ„ë¥¼ ì·¨ê¸‰í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"289,595","ì—°ê²°":""},
            {"ê³ ìœ ID":130,"ê°€ê²Œì´ë¦„":"ê²½ë™í•¨í¥ëƒ‰ë©´","ê°€ê²Œë¶„ë¥˜":"ìŒì‹ì (í•œì‹)","main_product":"ê°ˆë¹„íƒ•,ë§Œë‘,ë¬¼ëƒ‰ë©´,ë¹„ë¹”ëƒ‰ë©´,ìˆ˜ìœ¡,íšŒëƒ‰ë©´","ìœ„ì¹˜":"ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ê³ ì‚°ìë¡œ38ê¸¸/ë‹¤-17","íŠ¹ì§•":"ì‹œì›í•œ ëƒ‰ë©´ì„ ë§›ë³¼ ìˆ˜ ìˆëŠ” ê³³ì…ë‹ˆë‹¤.","ì¢Œí‘œ":"100,160","ì—°ê²°":""},
            {"ê³ ìœ ID":132,"ê°€ê²Œì´ë¦„":"ëŒ€ë°•ì •ìœ¡ì ","ê°€ê²Œë¶„ë¥˜":"ì •ìœ¡ì ","main_product":"ë¼ì§€ê°ˆë§¤ê¸°ì‚´,ë¼ì§€ê°ˆë¹„,ëª©ì‚´,ì‚¼ê²¹ì‚´,ì†Œê°ˆë¹„,ì†Œê³ ê¸°êµ­ê±°ë¦¬,ì†Œê³ ê¸°ë“±ì‹¬,ì†Œê¼¬ë¦¬,ì•ˆì‹¬),í•œìš°íŠ¹ìˆ˜ë¶€ìœ„(ì±„ë","ìœ„ì¹˜":"ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ê³ ì‚°ìë¡œ38ê¸¸/ë‹¤-14","íŠ¹ì§•":"ë‹¤ì–‘í•œ ë¶€ìœ„ì˜ ê³ ê¸°ë¥¼ íŒë§¤í•˜ë©°, ê³ ê¸‰ ë¶€ìœ„ì™€ êµ­ê±°ë¦¬ìš© ê³ ê¸°ë¥¼ ëª¨ë‘ êµ¬ë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.","ì¢Œí‘œ":"160,200","ì—°ê²°":""},
            {"ê³ ìœ ID":133,"ê°€ê²Œì´ë¦„":"ìš°ë¦¬ì¶•ì‚°","ê°€ê²Œë¶„ë¥˜":"ì •ìœ¡ì ","main_product":"ì–‘ë…ê°ˆë¹„,ëŒ€íŒ¨ì‚¼ê²¹ì‚´","ìœ„ì¹˜":"ê³ ì‚°ìë¡œ36ë²ˆê¸¸/ìš°","íŠ¹ì§•":"ìº í•‘ê°ˆ ë•Œ ì¢‹ì€ ì–‘ë…ìœ¡ì„ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"890,501","ì—°ê²°":""},
            {"ê³ ìœ ID":34,"ê°€ê²Œì´ë¦„":"ê±°ë¶ì´ì “ê°ˆ","ê°€ê²Œë¶„ë¥˜":"ë°˜ì°¬/ê¹€ì¹˜","main_product":"ê°ˆì¹˜ì†ì “,ê¼´ëšœê¸°ì “,ë‚™ì§€ì “,ëª…ë€ì “,ìƒˆìš°ì “,ì–´ë¦¬êµ´ì “,ì˜¤ì§•ì–´ì “,ì°½ë‚œì “","ìœ„ì¹˜":"ê³ ì‚°ìë¡œ36ë²ˆê¸¸/ì¢Œ","íŠ¹ì§•":"ë°¥ë°˜ì°¬ìœ¼ë¡œ ì¢‹ì€ ë‹¤ì–‘í•œ ì “ê°ˆì„ ì „ë¬¸ìœ¼ë¡œ íŒë§¤í•˜ë©°, ì “ê°ˆ ì¢…ë¥˜ê°€ ë‹¤ì–‘í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"232,470","ì—°ê²°":""},
            {"ê³ ìœ ID":62,"ê°€ê²Œì´ë¦„":"ê¸ˆì‚°ì¸ì‚¼","ê°€ê²Œë¶„ë¥˜":"ê°€ê³µì‹í’ˆ","main_product":"ë”ë•,ë„ë¼ì§€,ì‚°ì–‘ì‚¼,ìˆ˜ì‚¼,ì¸ì‚¼,ì¸ì‚¼ì£¼,í™ì‚¼ì•¡","ìœ„ì¹˜":"ê³ ì‚°ìë¡œ36ë²ˆê¸¸/ìš°","íŠ¹ì§•":"ê¸ˆì‚° ì§€ì—­ì˜ í’ˆì§ˆ ì¢‹ì€ ì¸ì‚¼ê³¼ ë”ë•, ë„ë¼ì§€ë¥¼ ì „ë¬¸ìœ¼ë¡œ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"527,501","ì—°ê²°":""},
            {"ê³ ìœ ID":137,"ê°€ê²Œì´ë¦„":"ê·¸ì‹œì ˆê·¸ë§›","ê°€ê²Œë¶„ë¥˜":"ìŒì‹ì (ì œê³¼ì œë¹µ)","main_product":"ê³ ë¡œì¼€,ê½ˆë°°ê¸°,ë„ë„ˆì¸ ,ë§˜ëª¨ìŠ¤ë¹µ,ì†Œì‹œì§€ë¹µ,ì°ë¹µ,ì°¹ìŒ€ë„ë„›","ìœ„ì¹˜":"ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ê³ ì‚°ìë¡œ38ê¸¸/ë‹¤-11","íŠ¹ì§•":"ì¶”ì–µì˜ ê°„ì‹ì¸ ê½ˆë°°ê¸°, ë„ë„ˆì¸  ë“±ì„ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"280,90","ì—°ê²°":""},
            {"ê³ ìœ ID":81,"ê°€ê²Œì´ë¦„":"ì„±í˜„ë¬¼ì‚°","ê°€ê²Œë¶„ë¥˜":"ë†ì‚°ë¬¼","main_product":"ë…¹ìš©,ë‹¹ê·€,ë”ë•,ë„ë¼ì§€,ì‘¥,ì˜¤ë¯¸ì,ì¸ì‚¼,ì¹¡,í™ì‚¼","ìœ„ì¹˜":"ì™•ì‚°ë¡œ29ê¸¸","íŠ¹ì§•":"ëª¸ì— ì¢‹ì€ ì•½ì´ˆì™€ ë¿Œë¦¬ ì±„ì†Œë¥¼ íŒë§¤í•©ë‹ˆë‹¤.","ì¢Œí‘œ":"257,304","ì—°ê²°":""}
        ];
        
        const storeData = marketData.map(store => {
            const productNames = store.main_product ? store.main_product.split(',') : [];
            const mainTags = productNames.slice(0, 2).map(tag => `#${tag.trim()}`);
            const products = productNames.map((productName, index) => {
                if (!productName.trim()) return null;
                return {
                    id: `${store.ê³ ìœ ID}-${index}`, name: productName.trim(),
                    price: Math.floor(Math.random() * (300 - 50) + 50) * 100,
                    img: `https://placehold.co/100x100/E0E7FF/4338CA?text=${encodeURIComponent(productName.trim().charAt(0))}`
                };
            }).filter(p => p !== null);
            return {
                id: store.ê³ ìœ ID, name: store.ê°€ê²Œì´ë¦„, category: store.ê°€ê²Œë¶„ë¥˜.replace('/', '/'),
                mainTags: mainTags, rating: (Math.random() * (5.0 - 4.0) + 4.0).toFixed(1),
                orders: Math.floor(Math.random() * 500) + 10, reviews: [], products: products
            };
        });
        
        let shoppingCart = {};
        let currentCategorySort = 'default';
        let favoriteStores = [];

        // ==================== ì„œë²„ í†µì‹  í•¨ìˆ˜ ====================
        async function sendOrderToServer(orderData) {
            try {
                const response = await fetch('/api/create-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                if (!response.ok) throw new Error((await response.json()).message || 'Server Error');
                return await response.json();
            } catch (error) {
                console.error("Server submission failed:", error);
                throw error;
            }
        }

        // ==================== UI HELPER FUNCTIONS (showMessage, showPromptBox ë“±) ====================
        function showMessage(message) { /* ... */ }
        function showPromptBox(title, message, callback) { /* ... */ }

        function showCartModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            let cartItemsHtml = '', totalPrice = 0;
            if (Object.keys(shoppingCart).length > 0) {
                for (const storeName in shoppingCart) {
                    const items = shoppingCart[storeName];
                    const itemDetails = items.map(item => {
                        totalPrice += item.price;
                        return `<p class="text-gray-600 text-sm">${item.name} - ${item.price.toLocaleString()}ì›</p>`;
                    }).join('');
                    cartItemsHtml += `<div class="bg-gray-50 p-3 rounded-lg mb-2"><p class="font-semibold text-gray-800 mb-1">${storeName}</p>${itemDetails}</div>`;
                }
            } else {
                 cartItemsHtml = `<p class="text-center text-gray-500 py-4">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.</p>`;
            }
            modal.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-xl font-bold mb-4">ì¥ë°”êµ¬ë‹ˆ</h3>
                    <div class="mb-4">
                        <label for="userIdInput" class="block text-sm font-medium text-gray-700 mb-2">ì£¼ë¬¸ì ID</label>
                        <input type="text" id="userIdInput" placeholder="ë‚˜ì¤‘ì— QRì„ ì°¾ì„ ë•Œ ì‚¬ìš©í•  ID" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>
                    <div class="space-y-3 max-h-60 overflow-y-auto mb-4">${cartItemsHtml}</div>
                    <div class="text-right font-bold text-xl my-4 border-t pt-4">ì´ ê²°ì œê¸ˆì•¡: <span class="text-indigo-600">${totalPrice.toLocaleString()}ì›</span></div>
                    <div class="flex flex-col space-y-2">
                        <button id="checkoutBtn" class="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700" ${totalPrice === 0 ? 'disabled' : ''}>ê²°ì œí•˜ê³  í”½ì—…í•˜ê¸°</button>
                        <button onclick="this.closest('.modal-overlay').remove()" class="w-full px-4 py-2 border rounded-lg text-gray-700 hover:bg-gray-100">ë‹«ê¸°</button>
                    </div>
                </div>`;
            document.getElementById('modalContainer').appendChild(modal);
            if (totalPrice > 0) {
                document.getElementById('checkoutBtn').addEventListener('click', handleCheckout);
            }
        }

        // ==================== ROUTING & RENDERING ====================
        function showScreen(screenId, param = null) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.screen === screenId));
            switch (screenId) {
                case 'categoryListScreen': if (param) renderCategoryList(param); break;
                case 'storeDetailScreen': if (param) renderStoreDetail(param); break;
                case 'favoritesScreen': renderFavoritesScreen(); break;
                // ... ë‹¤ë¥¸ í™”ë©´ ë Œë”ë§ ë¡œì§ ...
            }
        }

        function renderCategoryList(category) { /* ... */ }
        function renderStoreDetail({ storeId, from }) { /* ... */ }
        function renderFavoritesScreen() { /* ... */ }
        
        // ==================== í•µì‹¬ ë¡œì§ ====================
        async function handleCheckout() {
            const userId = document.getElementById('userIdInput').value.trim();
            if (!userId) return showMessage('ì£¼ë¬¸ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            const orderData = { userId, cart: shoppingCart, timestamp: new Date().toISOString() };
            try {
                await sendOrderToServer(orderData);
                const qrDataString = JSON.stringify(orderData);
                shoppingCart = {};
                document.querySelector('.modal-overlay')?.remove();
                showScreen('pickupScreen');
                const qrContainer = document.getElementById('fetchedQrContainer');
                qrContainer.innerHTML = `
                    <div class="bg-gray-50 p-6 rounded-lg text-center">
                        <h2 class="text-lg font-semibold text-gray-800">í”½ì—… ì¤€ë¹„ ì™„ë£Œ!</h2>
                        <p class="text-gray-500 mt-1">ID: <span class="font-bold text-indigo-600">${userId}</span></p>
                        <div id="generated-qrcode" class="mt-4 flex justify-center"></div>
                    </div>`;
                new QRCode(document.getElementById('generated-qrcode'), { text: qrDataString, width: 200, height: 200 });
                document.getElementById('viewUserIdInput').value = userId;
            } catch (error) {
                showMessage(`ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        async function fetchOrderQR() {
            const container = document.getElementById('fetchedQrContainer');
            const userId = document.getElementById('viewUserIdInput').value.trim();
            if (!userId) return showMessage('ì¡°íšŒí•  ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            container.innerHTML = '<p class="text-center text-gray-500 p-4">ì„œë²„ì—ì„œ ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ëŠ” ì¤‘...</p>';
            try {
                const response = await fetch(`/api/get-order/${userId}`);
                const data = await response.json();
                if (data.success) {
                    const order = data.order;
                    const qrDataString = JSON.stringify(order);
                    container.innerHTML = `
                        <div class="bg-gray-50 p-6 rounded-lg text-center">
                            <h2 class="text-lg font-semibold text-gray-800">ì£¼ë¬¸ ì •ë³´ í™•ì¸</h2>
                            <p class="text-gray-500 mt-1">ID: <span class="font-bold text-indigo-600">${order.userId}</span></p>
                            <div id="fetched-qrcode" class="mt-4 flex justify-center"></div>
                        </div>`;
                    new QRCode(document.getElementById('fetched-qrcode'), { text: qrDataString, width: 200, height: 200 });
                } else {
                    container.innerHTML = `<p class="text-center text-red-500 font-semibold p-4">${data.message}</p>`;
                }
            } catch (error) {
                container.innerHTML = `<p class="text-center text-red-500 font-semibold p-4">ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>`;
            }
        }
        
        function addToCart(storeName, productName, price) {
           if (!shoppingCart[storeName]) shoppingCart[storeName] = [];
           shoppingCart[storeName].push({ name: productName, price: price });
        }
        
        // ==================== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì´ˆê¸°í™” ====================
        window.showScreen = showScreen;
        window.showCartModal = showCartModal;
        window.fetchOrderQR = fetchOrderQR;
        // ... ê¸°íƒ€ ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ ...

        document.addEventListener('DOMContentLoaded', () => {
            // setupAllEventListeners(); // ì´ í•¨ìˆ˜ëŠ” ì œê³µëœ ì½”ë“œì— ì—†ìœ¼ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬
            showScreen('homeScreen');
        });
    })();
    </script>
</body>
</html>
